{"version":3,"sources":["webpack:///./src/assets/logo.svg","webpack:///./src/pages/ide/index.less","webpack:///./src/pages/ide/index.tsx"],"names":["require","serverUrl","isDev","html","useState","isUpdate","setUpdate","line","ch","cursor","setCursor","data","setData","handleChange","_editor","_data","value","fetchPage","useMemo","v","res","fetch","method","body","then","success","prev","downLoadHtml","file","File","Date","now","type","saveAs","onCursorChange","data1","useHotkeys","event","preventDefault","editHotKey","editor","ctrlKey","key","getValue","CodeMirrorRender","styles","codeWrap","mode","theme","lineNumbers","rect","useGetRect","height","phoneHeight","iframeHeight","wrap","header","logoArea","logo","Logo","logoText","operationBar","marginRight","contentWrap","position","previewWrap","width","margin","padding","border"],"mappings":"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","file":"p__ide.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/logo.3d15201a.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrap\":\"wrap___115df\",\"header\":\"header___16FzI\",\"logoArea\":\"logoArea___XBuLC\",\"backBtn\":\"backBtn___1Igl-\",\"logo\":\"logo___15WuW\",\"logoText\":\"logoText___2NazV\",\"operationBar\":\"operationBar___19VmI\",\"contentWrap\":\"contentWrap___xZYnv\",\"codeWrap\":\"codeWrap___1XZf2\",\"previewWrap\":\"previewWrap___31cfv\"};","import React, { useMemo } from 'react';\nimport { Controlled } from 'react-codemirror2';\nimport { useState } from 'react';\nimport { Button, message } from 'antd';\nimport { saveAs } from 'file-saver';\nimport Logo from '@/assets/logo.svg';\nimport styles from './index.less';\nimport { isDev, useGetRect } from 'utils/tool';\nimport { SaveOutlined } from '@ant-design/icons';\nimport { useHotkeys } from 'react-hotkeys-hook';\nrequire('codemirror/mode/xml/xml');\nrequire('codemirror/mode/javascript/javascript');\n\nconst serverUrl = isDev ? 'http://localhost:3000' : 'http://localhost:3000';\n\nlet html = `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n    <style>\n      html,body {\n        margin: 0;\n        padding: 0;\n      }\n      #root {\n        padding-top: 200px;\n        text-align: center;\n      }\n      p {\n        padding: 0 10px;\n        color: #06c;\n        line-height: 1.8;\n        font-size: 12px;\n      }\n    </style>\n  </head>\n  <body>\n    <div id=\"root\">\n      <img src=\"http://io.nainor.com/uploads/logo_1747374040f.png\" />\n      <p>\n        (H5编辑器)H5-Dooring是一款功能强大，开源免费的H5可视化页面配置解决方案，\n        致力于提供一套简单方便、专业可靠、无限可能的H5落地页最佳实践。\n      </p>\n    </div>\n  </body>\n</html>\n`;\n\nexport default function() {\n  const [isUpdate, setUpdate] = useState(false);\n  const [cursor, setCursor] = useState<CodeMirror.Position>({ line: 1, ch: 1 });\n  const [data, setData] = useState<{ data: string }>({ data: html });\n  const handleChange = (\n    _editor: CodeMirror.Editor,\n    _data: CodeMirror.EditorChange,\n    value: string,\n  ) => {\n    setData({ data: value });\n  };\n  const fetchPage = useMemo(() => {\n    return (v?: string) => {\n      let res = v ?? data.data;\n      fetch(`${serverUrl}/dooring/render`, { method: 'POST', body: res }).then(() => {\n        html = res;\n        message.success('已保存');\n        setUpdate(prev => !prev);\n      });\n    };\n  }, [data]);\n  const downLoadHtml = () => {\n    var file = new File([data.data], `${Date.now()}.html`, { type: 'text/html;charset=utf-8' });\n    saveAs(file);\n  };\n\n  const onCursorChange = (_editor: CodeMirror.Editor, data1: CodeMirror.Position) => {\n    const { line, ch } = data1;\n    setCursor({ line, ch });\n  };\n\n  useHotkeys<HTMLDivElement>(\n    'ctrl+s',\n    event => {\n      fetchPage();\n      event.preventDefault();\n    },\n    [data],\n  );\n\n  const editHotKey = useMemo(() => {\n    return (editor: CodeMirror.Editor, event: KeyboardEvent) => {\n      if (event.ctrlKey && event.key === 's') {\n        fetchPage(editor.getValue());\n        event.preventDefault();\n      }\n    };\n  }, [fetchPage]);\n\n  const CodeMirrorRender = useMemo(() => {\n    return (\n      <Controlled\n        className={styles.codeWrap}\n        value={data.data}\n        options={{\n          mode: 'xml',\n          theme: 'material',\n          lineNumbers: true,\n        }}\n        onBeforeChange={handleChange}\n        cursor={cursor}\n        onCursor={onCursorChange}\n        onKeyDown={editHotKey}\n      />\n    );\n  }, [cursor, data.data, editHotKey]);\n\n  const rect = useGetRect();\n  const height = useMemo(() => {\n    let res = rect.height - 42 - 1; //-1防止差值产生滚动条\n    return res < 694 ? 694 : res;\n  }, [rect.height]);\n\n  const phoneHeight = useMemo(() => {\n    //let res = rect.height - 42 - 30 - 1; //30是其上边距\n    //return res < 694 ? 694 : res;\n    return 694; //大屏幕过长，维持高度，需要变高另外处理\n  }, []);\n  const iframeHeight = useMemo(() => {\n    return phoneHeight - 30 - 12 - 12; //上边距30 上下padding 12\n  }, [phoneHeight]);\n\n  return (\n    <div className={styles.wrap}>\n      <div className={styles.header}>\n        <div className={styles.logoArea}>\n          <div className={styles.logo} title=\"Dooring\">\n            <a href=\"http://io.nainor.com/h5_visible\">\n              <img src={Logo} alt=\"Dooring-强大的h5编辑器\" />\n            </a>\n          </div>\n          <div className={styles.logoText}>| 在线代码编辑器</div>\n        </div>\n        <div className={styles.operationBar}>\n          <Button\n            type=\"primary\"\n            title=\"保存（ctrl+s）\"\n            onClick={() => fetchPage()}\n            style={{ marginRight: '10px' }}\n          >\n            <SaveOutlined />\n          </Button>\n          <Button type=\"primary\" onClick={downLoadHtml} style={{ marginRight: '10px' }}>\n            下载页面\n          </Button>\n          <Button danger onClick={downLoadHtml}>\n            一键部署\n          </Button>\n        </div>\n      </div>\n      <div className={styles.contentWrap} style={{ height: `${height}px`, position: 'relative' }}>\n        <div className={styles.codeWrap} style={{ height: `${height}px`, position: 'relative' }}>\n          {CodeMirrorRender}\n        </div>\n\n        <div className={styles.previewWrap} style={{ height: `${phoneHeight}px` }}>\n          <iframe\n            title=\"preview\"\n            src={`${serverUrl}/html?flag=${isUpdate}`}\n            style={{\n              width: '100%',\n              height: `${iframeHeight}px`,\n              margin: 0,\n              padding: 0,\n              border: 'none',\n            }}\n          ></iframe>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"sourceRoot":""}